webpackJsonp([1],{LAt7:function(e,n){},NHnr:function(e,n,t){"use strict";function i(e){t("ukfr")}function r(e){t("sFSK")}function o(e){t("LAt7")}Object.defineProperty(n,"__esModule",{value:!0});var a=t("/5sW"),l={name:"app"},s=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"app"}},[t("router-view",{staticClass:"page"})],1)},c=[],d={render:s,staticRenderFns:c},f=d,u=t("VU/8"),p=i,h=u(l,f,!1,p,null,null),v=h.exports,m=t("/ocq"),g=t("//Fk"),y=t.n(g),b=function(){return(Math.round(100*performance.now())/100).toString()},w=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return function(t,i){var r=b().padEnd(n)+" | ";if("string"==typeof t){var o=r+t;void 0===i?e(o):e(o,i)}else e(r,i)}},k=w(console.log.bind(console)),_=w(console.error.bind(console),12);k.error=_;var F=k,I=t("i58a"),C=t.n(I),x=t("zsG3"),z=t.n(x),D=function(){var e=[],n={},t=function(e,t){n[e]||(n[e]=[]),n[e].push(t)},i=function(e,t,i){n[e]&&n[e].forEach(function(e){return e(t,i)})},r=function(n){F("new peer connected: "+n.id),e.push(n),n.on("data",function(e){return i("data",n,e)}),n.on("close",function(){F("connection "+n.id+" leave us"),e=e.filter(function(e){return e!==n})})};return new y.a(function(n,i){var o=new z.a({key:C.a.peerjs.key});o.on("open",function(i){F("peer initialized with id: "+i),n({id:i,peer:o,on:t,connections:e})}),o.on("connection",r),o.on("error",function(e){F.error("peer problem",e),i(e)})})},L=function(e){var n=document.createElement("textarea");n.style.position="fixed",n.style.top=0,n.style.left=0,n.style.width="2em",n.style.height="2em",n.style.padding=0,n.style.border="none",n.style.outline="none",n.style.boxShadow="none",n.style.background="transparent",n.value=e,document.body.appendChild(n),n.select();var t=!1;try{document.execCommand("copy"),t=!0}catch(n){F.error("copying has failed ("+e+")")}return document.body.removeChild(n),t},S=L,E=t("jmmJ"),j=t.n(E),R=function(){return j()({length:32})},U=function(e,n){return(location.hash?location.href.slice(0,0-location.hash.length):location.href)+"#/file/"+e+"/"+n},q={name:"SharePage",data:function(){return{peer:null,failed:!1,loading:!0,files:window.files||(window.files=[])}},methods:{onDrop:function(e){for(var n=e.dataTransfer.files,t=n.length;t--;)this.addFile(n[t])},onSelectFile:function(e){for(var n=e.target.files,t=n.length;t--;)this.addFile(n[t])},addFile:function(e){var n={id:R(),name:e.name,size:e.size,type:e.type,file:e};this.files.push(n),this.peer&&this.shareFile(n)},shareFile:function(e){e.link=U(this.peer.id,e.id),F("link for "+e.name+": "+e.link)},sendFile:function(e,n){var t=n.name,i=n.type,r=new Blob([n.file],{type:i});e.send({method:"sendFile",file:{blob:r,name:t,type:i}})},copyLink:function(e){e.link?(F("copying link for "+e.name+": "+e.link),S(e.link)):F.error("link is not ready for "+e.name)},receiveData:function(e,n){switch(n.method){case"requestFile":F("requested "+n.fileId+" file");var t=this.files.find(function(e){return e.id===n.fileId});t?(F("sending file "+t.id+" ("+t.name+")"),this.sendFile(e,t)):(F.error("not exists file is requested "+n.fileId),e.send({method:"error",error:"no matching file found",fileId:n.fileId}));break;default:F.error("unknown event "+n.method+" is received",n)}}},filters:{size:function(e){return Math.round(e/1024/1024*100)/100+"Mb"}},mounted:function(){var e=this;F("creating new peer"),D().then(function(n){e.loading=!1,e.peer=n,e.peer.on("data",e.receiveData.bind(e)),e.files.forEach(function(n){return e.shareFile(n)})},function(n){e.failed=!0,F.error(n)})}},P=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"share-page",class:{failed:e.failed,loading:e.loading},on:{drop:function(n){n.preventDefault(),e.onDrop(n)},dragover:function(e){e.preventDefault()}}},[t("div",{staticClass:"content"},[e.files.length?e._e():t("div",{staticClass:"placeholder"},[t("p",[e._v("\n        drop files here,"),t("br"),e._v("or\n        "),t("label",[e._v("\n          choose them\n          "),t("input",{attrs:{type:"file",name:"files",multiple:""},on:{change:e.onSelectFile}})])])]),e._v(" "),e.files.length?t("div",{staticClass:"list"},[t("ul",e._l(e.files,function(n){return t("li",{attrs:{tabindex:"0"},on:{click:function(t){e.copyLink(n)}}},[e._v("\n          "+e._s(n.name)+"\n          ("+e._s(e._f("size")(n.size))+")\n        ")])})),e._v(" "),t("p",{staticClass:"tip"},[e._v("click the file name to copy the link")])]):e._e()])])},$=[],B={render:P,staticRenderFns:$},H=B,M=t("VU/8"),O=r,A=M(q,H,!1,O,"data-v-3b18e90c",null),K=A.exports,N=function(e,n){var t=document.createElement("a");t.style="display: none",t.href=e,t.download=n,document.body.appendChild(t),t.click(),console.log(t),t.remove()},V=N,G=function(e){var n={},t=function(e,t){n[e]||(n[e]=[]),n[e].push(t)},i=function(e,t){n[e]&&n[e].forEach(function(e){return e(t)})};return new y.a(function(n,r){var o=new z.a({key:C.a.peerjs.key});o.on("open",function(a){F("peer initialized with id: "+a);var l=o.connect(e);l.on("data",function(e){return i("data",e)}),l.on("open",function(){F("connected to remote peer "+e),n({id:a,peer:o,connection:l,on:t})}),l.on("error",function(e){F.error("connection problem",e),r(e)})}),o.on("error",function(e){F.error("peer problem",e),r(e)})})},J={name:"FilePage",data:function(){return{peer:null,loading:!0,failed:!1,error:null}},computed:{peerId:function(){return this.$route.params.peer},fileId:function(){return this.$route.params.file}},methods:{downloadFile:function(){F("request file "+this.fileId),this.send({method:"requestFile",fileId:this.fileId})},send:function(e){this.peer.connection.send(e)},receiveData:function(e){switch(e.method){case"sendFile":F("remote server send a file "+e.file.name,e);var n=new Blob([e.file.blob],{type:e.file.type}),t=URL.createObjectURL(n);V(t,e.file.name),URL.revokeObjectURL(t);break;case"error":F.error("remote server send an error",e);break;default:F.error("unknown event "+e.method+" is received",e)}}},mounted:function(){var e=this;G(this.peerId).then(function(n){e.peer=n,e.peer.on("data",e.receiveData.bind(e))}).then(function(){e.loading=!1})}},T=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"file-page",class:{failed:e.failed,loading:e.loading}},[t("div",{staticClass:"content"},[e.loading?t("p",[e._v("loading...")]):e._e(),e._v(" "),e.loading?e._e():t("div",[e.failed?e._e():t("input",{attrs:{type:"button",value:"download file"},on:{click:e.downloadFile}}),e._v(" "),e.failed?t("p",[e._v(e._s(e.error))]):e._e()])])])},W=[],Q={render:T,staticRenderFns:W},X=Q,Y=t("VU/8"),Z=o,ee=Y(J,X,!1,Z,"data-v-e9eda466",null),ne=ee.exports;a.a.use(m.a);var te=new m.a({routes:[{path:"/",name:"SharePage",component:K},{path:"/file/:peer/:file",name:"DownloadPage",component:ne}]});a.a.config.productionTip=!1,F("start new application"),new a.a({el:"#app",router:te,render:function(e){return e(v)}})},i58a:function(e,n){e.exports={firebase:{apiKey:"AIzaSyBHsb4fmCGupwqcdz5bdDnOpSNLpHwWvLw",authDomain:"webrtc-sfs.firebaseapp.com",databaseURL:"https://webrtc-sfs.firebaseio.com",projectId:"webrtc-sfs",storageBucket:"",messagingSenderId:"685746255008"},peerjs:{key:"zcn86e7y7xkr19k9"}}},sFSK:function(e,n){},ukfr:function(e,n){}},["NHnr"]);
//# sourceMappingURL=app.f94e3f7445e7591d38bb.js.map